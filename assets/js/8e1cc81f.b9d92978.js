"use strict";(self.webpackChunkduroom_docs=self.webpackChunkduroom_docs||[]).push([[9457],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return f}});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),u=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return i.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=u(n),f=o,d=m["".concat(l,".").concat(f)]||m[f]||c[f]||a;return n?i.createElement(d,r(r({ref:t},p),{},{components:n})):i.createElement(d,r({ref:t},p))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var u=2;u<a;u++)r[u]=n[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8071:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return f},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return c}});var i=n(7462),o=n(3366),a=(n(7294),n(3905)),r=["components"],s={},l="Notifications",u={unversionedId:"extend/notifications",id:"extend/notifications",title:"Notifications",description:"DuRoom includes a powerful notification system to alert users to new activity.",source:"@site/docs/extend/notifications.md",sourceDirName:"extend",slug:"/extend/notifications",permalink:"/extend/notifications",draft:!1,editUrl:"https://github.com/DuRoom/docs/tree/master/docs/extend/notifications.md",tags:[],version:"current",frontMatter:{},sidebar:"extendSidebar",previous:{title:"Model Slugging",permalink:"/extend/slugging"},next:{title:"Post Types",permalink:"/extend/post-types"}},p={},c=[{value:"Notification Types",id:"notification-types",level:2},{value:"Defining a Notification Type",id:"defining-a-notification-type",level:3},{value:"Registering a Notification Type",id:"registering-a-notification-type",level:3},{value:"Mailable Notifications",id:"mailable-notifications",level:3},{value:"Notification Drivers",id:"notification-drivers",level:3},{value:"Rendering Notifications",id:"rendering-notifications",level:2},{value:"Sending Notifications",id:"sending-notifications",level:2}],m={toc:c};function f(e){var t=e.components,n=(0,o.Z)(e,r);return(0,a.kt)("wrapper",(0,i.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"notifications"},"Notifications"),(0,a.kt)("p",null,"DuRoom includes a powerful notification system to alert users to new activity."),(0,a.kt)("h2",{id:"notification-types"},"Notification Types"),(0,a.kt)("h3",{id:"defining-a-notification-type"},"Defining a Notification Type"),(0,a.kt)("p",null,"To define a notification type, you will need to create a new class which implements ",(0,a.kt)("inlineCode",{parentName:"p"},"DuRoom\\Notification\\Blueprint\\BlueprintInterface"),". This class will define your notification's content and behaviour through the following methods:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"getFromUser()")," The ",(0,a.kt)("inlineCode",{parentName:"li"},"User")," model for the user that triggered the notification."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"getSubject()")," The model that the notification is about (eg. the ",(0,a.kt)("inlineCode",{parentName:"li"},"Post")," that was liked)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"getData()")," Any other data you might wish to include for access on the frontend (eg. the old discussion title when renamed)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"getType()")," This is where you name your notification, this will be important for later steps."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"getSubjectModal()"),": Specify the type of model the subject is (from ",(0,a.kt)("inlineCode",{parentName:"li"},"getSubject"),").")),(0,a.kt)("p",null,"Lets take a look at an example from ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/likes/blob/master/src/Notification/PostLikedBlueprint.php"},"DuRoom Likes"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace DuRoom\\Likes\\Notification;\n\nuse DuRoom\\Notification\\Blueprint\\BlueprintInterface;\nuse DuRoom\\Post\\Post;\nuse DuRoom\\User\\User;\n\nclass PostLikedBlueprint implements BlueprintInterface\n{\n    public $post;\n\n    public $user;\n\n    public function __construct(Post $post, User $user)\n    {\n        $this->post = $post;\n        $this->user = $user;\n    }\n\n    public function getSubject()\n    {\n        return $this->post;\n    }\n\n    public function getFromUser()\n    {\n        return $this->user;\n    }\n\n    public function getData()\n    {\n    }\n\n    public static function getType()\n    {\n        return 'postLiked';\n    }\n\n    public static function getSubjectModel()\n    {\n        return Post::class;\n    }\n}\n")),(0,a.kt)("p",null,"Take a look at ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/framework/blob/main/framework/core/src/Notification/Blueprint/DiscussionRenamedBlueprint.php"},(0,a.kt)("inlineCode",{parentName:"a"},"DiscussionRenamedBlueprint"))," if you want another example."),(0,a.kt)("h3",{id:"registering-a-notification-type"},"Registering a Notification Type"),(0,a.kt)("p",null,"Next, let's register your notification so DuRoom knows about it. This will allow users to be able to change how they want to be notified of your notification.\nWe can do this with the ",(0,a.kt)("inlineCode",{parentName:"p"},"type")," method of the ",(0,a.kt)("inlineCode",{parentName:"p"},"Notification")," extender"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"$blueprint"),": Your class static (example: ",(0,a.kt)("inlineCode",{parentName:"li"},"PostLikedBlueprint::class"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"$serializer"),": The serializer of your subject model (example: ",(0,a.kt)("inlineCode",{parentName:"li"},"PostSerializer::class"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"$enabledByDefault"),": This is where you set which notification methods will be enabled by default. It accepts an array of strings, include 'alert' to have forum notifications (the bell icon), include 'email' for email notifications. You can use, one both, or none! (example: ",(0,a.kt)("inlineCode",{parentName:"li"},"['alert']")," would set only in-forum notifications on by default)")),(0,a.kt)("p",null,"Lets look at an example from ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/subscriptions/blob/master/extend.php"},"DuRoom Subscriptions"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nuse DuRoom\\Api\\Serializer\\BasicDiscussionSerializer;\nuse DuRoom\\Extend\nuse DuRoom\\Subscriptions\\Notification\\NewPostBlueprint;\n\nreturn [\n    // Other extenders\n    (new Extend\\Notification())\n        ->type(NewPostBlueprint::class, BasicDiscussionSerializer::class, ['alert', 'email']),\n    // Other extenders\n];\n")),(0,a.kt)("p",null,"Your notification is coming together nicely! Just a few things left to do!"),(0,a.kt)("h3",{id:"mailable-notifications"},"Mailable Notifications"),(0,a.kt)("p",null,"In addition to registering our notification to send by email, if we actually want it to send, we need to provide a bit more information: namely, code for generating the email subject and body.\nTo do this, your notification blueprint should implement ",(0,a.kt)("a",{parentName:"p",href:"https://api.duroom.js.org/docs/php/master/duroom/notification/mailableinterface"},(0,a.kt)("inlineCode",{parentName:"a"},"DuRoom\\Notification\\MailableInterface"))," in addition to ",(0,a.kt)("a",{parentName:"p",href:"https://api.duroom.js.org/docs/php/master/duroom/notification/blueprint/blueprintinterface"},(0,a.kt)("inlineCode",{parentName:"a"},"DuRoom\\Notification\\Blueprint\\BlueprintInterface")),".\nThis comes with 2 additional methods:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"getEmailView()")," should return an array of email type to ",(0,a.kt)("a",{parentName:"li",href:"https://laravel.com/docs/8.x/blade"},"Blade View")," names. The namespaces for these views must ",(0,a.kt)("a",{parentName:"li",href:"/extend/routes#views"},"first be registered"),". These will be used to generate the body of the email."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"getEmailSubject(TranslatorInterface $translator)")," should return a string for the email subject. An instance of the translator is passed in to enable translated notification emails.")),(0,a.kt)("p",null,"Let's take a look at an example from ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/mentions/blob/master/src/Notification/PostMentionedBlueprint.php"},"DuRoom Mentions")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace DuRoom\\Mentions\\Notification;\n\nuse DuRoom\\Notification\\Blueprint\\BlueprintInterface;\nuse DuRoom\\Notification\\MailableInterface;\nuse DuRoom\\Post\\Post;\nuse Symfony\\Contracts\\Translation\\TranslatorInterface;\n\nclass PostMentionedBlueprint implements BlueprintInterface, MailableInterface\n{\n    /**\n     * @var Post\n     */\n    public $post;\n\n    /**\n     * @var Post\n     */\n    public $reply;\n\n    /**\n     * @param Post $post\n     * @param Post $reply\n     */\n    public function __construct(Post $post, Post $reply)\n    {\n        $this->post = $post;\n        $this->reply = $reply;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function getSubject()\n    {\n        return $this->post;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function getFromUser()\n    {\n        return $this->reply->user;\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function getData()\n    {\n        return ['replyNumber' => (int) $this->reply->number];\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function getEmailView()\n    {\n        return ['text' => 'duroom-mentions::emails.postMentioned'];\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public function getEmailSubject(TranslatorInterface $translator)\n    {\n        return $translator->trans('duroom-mentions.email.post_mentioned.subject', [\n            '{replier_display_name}' => $this->post->user->display_name,\n            '{title}' => $this->post->discussion->title\n        ]);\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public static function getType()\n    {\n        return 'postMentioned';\n    }\n\n    /**\n     * {@inheritdoc}\n     */\n    public static function getSubjectModel()\n    {\n        return Post::class;\n    }\n}\n")),(0,a.kt)("h3",{id:"notification-drivers"},"Notification Drivers"),(0,a.kt)("p",null,"In addition to registering notification types, we can also add new drivers alongside the default ",(0,a.kt)("inlineCode",{parentName:"p"},"alert")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"email"),".\nThe driver should implement ",(0,a.kt)("inlineCode",{parentName:"p"},"DuRoom\\Notification\\Driver\\NotificationDriverInterface"),". Let's look at an annotated example from the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/pusher/blob/master/src/PusherNotificationDriver.php"},"Pusher extension"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace DuRoom\\Pusher;\n\nuse DuRoom\\Notification\\Blueprint\\BlueprintInterface;\nuse DuRoom\\Notification\\Driver\\NotificationDriverInterface;\nuse Illuminate\\Contracts\\Queue\\Queue;\n\nclass PusherNotificationDriver implements NotificationDriverInterface\n{\n    /**\n     * @var Queue\n     */\n    protected $queue;\n\n    public function __construct(Queue $queue)\n    {\n        $this->queue = $queue;\n    }\n\n    /**\n     * {@inheritDoc}\n     */\n    public function send(BlueprintInterface $blueprint, array $users): void\n    {\n        // The `send` method is responsible for determining any notifications need to be sent.\n        // If not (for example, if there are no users to send to), there's no point in scheduling a job.\n        // We HIGHLY recommend that notifications are sent via a queue job for performance reasons.\n        if (count($users)) {\n            $this->queue->push(new SendPusherNotificationsJob($blueprint, $users));\n        }\n    }\n\n    /**\n     * {@inheritDoc}\n     */\n    public function registerType(string $blueprintClass, array $driversEnabledByDefault): void\n    {\n        // This method is generally used to register a user preference for this notification.\n        // In the case of pusher, there's no need for this.\n    }\n}\n")),(0,a.kt)("p",null,"Notification drivers are also registered via the ",(0,a.kt)("inlineCode",{parentName:"p"},"Notification")," extender, using the ",(0,a.kt)("inlineCode",{parentName:"p"},"driver")," method. The following arguments are provided"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"$driverName"),": A unique, human readable name for the driver"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"$driverClass"),": The class static of the driver (example: ",(0,a.kt)("inlineCode",{parentName:"li"},"PostSerializer::class"),")"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"$typesEnabledByDefault"),": An array of types for which this driver should be enabled by default. This will be used in calculating ",(0,a.kt)("inlineCode",{parentName:"li"},"$driversEnabledByDefault"),", which is provided to the ",(0,a.kt)("inlineCode",{parentName:"li"},"registerType")," method of the driver.")),(0,a.kt)("p",null,"Another example from ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/pusher/blob/master/extend.php"},"DuRoom Pusher"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nuse DuRoom\\Extend\nuse DuRoom\\Pusher\\PusherNotificationDriver;\n\nreturn [\n    // Other extenders\n    (new Extend\\Notification())\n        ->driver('pusher', PusherNotificationDriver::class),\n    // Other extenders\n];\n")),(0,a.kt)("h2",{id:"rendering-notifications"},"Rendering Notifications"),(0,a.kt)("p",null,"As with everything in DuRoom, what we register in the backend, must be registered in the frontend as well."),(0,a.kt)("p",null,"Similar to the notification blueprint, we need tell DuRoom how we want our notification displayed."),(0,a.kt)("p",null,"First, create a class that extends the notification component. Then, there are 4 functions to add:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"icon()"),": The ",(0,a.kt)("a",{parentName:"li",href:"https://fontawesome.com/"},"Font Awesome")," icon that will appear next to the notification text (example: ",(0,a.kt)("inlineCode",{parentName:"li"},"fas fa-code-branch"),")."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"href()"),": The link that should be opened when the notification is clicked (example: ",(0,a.kt)("inlineCode",{parentName:"li"},"app.route.post(this.attrs.notification.subject())"),")."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"content()"),": What the notification itself should show. It should say the username and then the action. It will be followed by when the notification was sent (make sure to use translations)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"exerpt()"),": (optional) A little excerpt that is shown below the notification (commonly an excerpt of a post).")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Let take a look at our example shall we?")),(0,a.kt)("p",null,"From ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/subscriptions/blob/master/js/src/forum/components/NewPostNotification.js"},"DuRoom Subscriptions"),", when a new post is posted on a followed discussion:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"harmony",harmony:!0},"import Notification from 'duroom/forum/components/Notification';\nimport username from 'duroom/common/helpers/username';\n\nexport default class NewPostNotification extends Notification {\n  icon() {\n    return 'fas fa-star';\n  }\n\n  href() {\n    const notification = this.attrs.notification;\n    const discussion = notification.subject();\n    const content = notification.content() || {};\n\n    return app.route.discussion(discussion, content.postNumber);\n  }\n\n  content() {\n    return app.translator.trans('duroom-subscriptions.forum.notifications.new_post_text', {user: this.attrs.notification.fromUser()});\n  }\n}\n")),(0,a.kt)("p",null,'In the example, the icon is a star, the link will go to the new post, and the content will say that "{user} posted".'),(0,a.kt)("p",null,"Next, we need to tell DuRoom that the notification you send in the backend corresponds to the frontend notification we just created."),(0,a.kt)("p",null,"Open up your index.js (the forum one) and start off by importing your newly created notification template. Then add the following line:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"app.notificationComponents.{nameOfNotification} = {NotificationTemplate};")),(0,a.kt)("p",null,"Make sure to replace ",(0,a.kt)("inlineCode",{parentName:"p"},"{nameOfNotification}")," with the name of the notification in your PHP blueprint (",(0,a.kt)("inlineCode",{parentName:"p"},"getType()"),") and replace ",(0,a.kt)("inlineCode",{parentName:"p"},"{NotificationTemplate}")," with the name of the JS notification template we just made! (Make sure it's imported!)"),(0,a.kt)("p",null,"Let's give users an option to change their settings for your notification. All you have to do is extend the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/framework/blob/main/framework/core/js/src/forum/components/NotificationGrid.js"},(0,a.kt)("inlineCode",{parentName:"a"},"notificationGrid")),"'s ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/framework/blob/main/framework/core/js/src/forum/components/NotificationGrid.js#L204"},(0,a.kt)("inlineCode",{parentName:"a"},"notificationTypes()"))," function"),(0,a.kt)("p",null,"From ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/likes/blob/master/js/src/forum/index.js"},"DuRoom-Likes"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { extend } from 'DuRoom/common/extend';\nimport app from 'DuRoom/forum/app';\nimport NotificationGrid from 'DuRoom/forum/components/NotificationGrid';\n\nimport PostLikedNotification from './components/PostLikedNotification';\n\napp.initializers.add('DuRoom-likes', () => {\n  app.notificationComponents.postLiked = PostLikedNotification;\n\n  extend(NotificationGrid.prototype, 'notificationTypes', function (items) {\n    items.add('postLiked', {\n      name: 'postLiked',\n      icon: 'far fa-thumbs-up',\n      label: app.translator.trans('DuRoom-likes.forum.settings.notify_post_liked_label')\n    });\n  });\n});\n")),(0,a.kt)("p",null,"Simply add the name of your notification (from the blueprint), an icon you want to show, and a description of the notification and you are all set!"),(0,a.kt)("h2",{id:"sending-notifications"},"Sending Notifications"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Data doesn't just appear in the database magically")),(0,a.kt)("p",null,"Now that you have your notification all setup, it's time to actually send the notification to the user!"),(0,a.kt)("p",null,"Thankfully, this is the easiest part, simply use",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/framework/blob/main/framework/core/src/Notification/NotificationSyncer.php"},(0,a.kt)("inlineCode",{parentName:"a"},"NotificationSyncer")),"'s sync function. It accepts 2 arguments:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"BlueprintInterface"),": This is the blueprint to be instantiated we made in the first step, you must include all variables that are used on the blueprint (example: if a user likes a post you must include the ",(0,a.kt)("inlineCode",{parentName:"li"},"user")," model that liked the post)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"$users"),": This accepts an array of ",(0,a.kt)("inlineCode",{parentName:"li"},"user")," modals that should receive the notification")),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Whats that? You want to be able to delete notifications too?")," The easiest way to remove a notification is to pass the exact same data as sending a notification, except with an empty array of recipients."),(0,a.kt)("p",null,"Lets take a look at our ",(0,a.kt)("strong",{parentName:"p"},"final")," example for today:"),(0,a.kt)("p",null,"From ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/likes/blob/master/src/Listener/SendNotificationWhenPostIsLiked.php"},"DuRoom Likes"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nnamespace DuRoom\\Likes\\Listener;\n\nuse DuRoom\\Event\\ConfigureNotificationTypes;\nuse DuRoom\\Likes\\Event\\PostWasLiked;\nuse DuRoom\\Likes\\Event\\PostWasUnliked;\nuse DuRoom\\Likes\\Notification\\PostLikedBlueprint;\nuse DuRoom\\Notification\\NotificationSyncer;\nuse DuRoom\\Post\\Post;\nuse DuRoom\\User\\User;\nuse Illuminate\\Contracts\\Events\\Dispatcher;\n\nclass SendNotificationWhenPostIsLiked\n{\n    protected $notifications;\n\n    public function __construct(NotificationSyncer $notifications)\n    {\n        $this->notifications = $notifications;\n    }\n\n    public function subscribe(Dispatcher $events)\n    {\n        $events->listen(PostWasLiked::class, [$this, 'whenPostWasLiked']);\n        $events->listen(PostWasUnliked::class, [$this, 'whenPostWasUnliked']);\n    }\n\n    public function whenPostWasLiked(PostWasLiked $event)\n    {\n        $this->syncNotification($event->post, $event->user, [$event->post->user]);\n    }\n\n    public function whenPostWasUnliked(PostWasUnliked $event)\n    {\n        $this->syncNotification($event->post, $event->user, []);\n    }\n\n    public function syncNotification(Post $post, User $user, array $recipients)\n    {\n        if ($post->user->id != $user->id) {\n            $this->notifications->sync(\n                new PostLikedBlueprint($post, $user),\n                $recipients\n            );\n        }\n    }\n}\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Awesome!")," Now you can spam users with updates on happenings around the forum!"),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"Tried everything?")," Well if you've tried everything then I guess... Kidding. Feel free to post in the ",(0,a.kt)("a",{parentName:"p",href:"https://discuss-duroom.js.org/t/extensibility"},"DuRoom Community")," and someone will be around to lend a hand!"))}f.isMDXComponent=!0}}]);