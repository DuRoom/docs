"use strict";(self.webpackChunkduroom_docs=self.webpackChunkduroom_docs||[]).push([[9823],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(n),d=a,g=c["".concat(l,".").concat(d)]||c[d]||m[d]||r;return n?o.createElement(g,s(s({ref:t},u),{},{components:n})):o.createElement(g,s({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var p=2;p<r;p++)s[p]=n[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},6814:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return m}});var o=n(7462),a=n(3366),r=(n(7294),n(3905)),s=["components"],i={},l="Frontend Pages and Resolvers",p={unversionedId:"extend/frontend-pages",id:"extend/frontend-pages",title:"Frontend Pages and Resolvers",description:"As explained in the Routes and Content documentation, we can use Mithril's routing system to show different components for different routes. Mithril allows you to use any component you like, even a Modal or Alert, but we recommend sticking to component classes that inherit the Page component.",source:"@site/docs/extend/frontend-pages.md",sourceDirName:"extend",slug:"/extend/frontend-pages",permalink:"/extend/frontend-pages",draft:!1,editUrl:"https://github.com/DuRoom/docs/tree/master/docs/extend/frontend-pages.md",tags:[],version:"current",frontMatter:{},sidebar:"extendSidebar",previous:{title:"Authorization",permalink:"/extend/authorization"},next:{title:"Interactive Components",permalink:"/extend/interactive-components"}},u={},m=[{value:"The Page Component",id:"the-page-component",level:2},{value:"Setting Page as Homepage",id:"setting-page-as-homepage",level:3},{value:"Page Titles",id:"page-titles",level:3},{value:"PageState",id:"pagestate",level:2},{value:"Admin Pages",id:"admin-pages",level:2},{value:"Route Resolvers (Advanced)",id:"route-resolvers-advanced",level:2},{value:"Using Route Resolvers",id:"using-route-resolvers",level:3},{value:"Custom Resolvers",id:"custom-resolvers",level:3}],c={toc:m};function d(e){var t=e.components,n=(0,a.Z)(e,s);return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"frontend-pages-and-resolvers"},"Frontend Pages and Resolvers"),(0,r.kt)("p",null,"As explained in the ",(0,r.kt)("a",{parentName:"p",href:"/extend/routes#frontend-routes"},"Routes and Content")," documentation, we can use Mithril's routing system to show different ",(0,r.kt)("a",{parentName:"p",href:"/extend/frontend#components"},"components")," for different routes. Mithril allows you to use any component you like, even a Modal or Alert, but we recommend sticking to component classes that inherit the ",(0,r.kt)("inlineCode",{parentName:"p"},"Page")," component."),(0,r.kt)("h2",{id:"the-page-component"},"The Page Component"),(0,r.kt)("p",null,"We provide ",(0,r.kt)("inlineCode",{parentName:"p"},"duroom/common/components/Page")," as a base class for pages in both the ",(0,r.kt)("inlineCode",{parentName:"p"},"admin")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"forum")," frontends. It has a few benefits:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Automatically updates ",(0,r.kt)("a",{parentName:"li",href:"#pagestate"},(0,r.kt)("inlineCode",{parentName:"a"},"app.current")," and ",(0,r.kt)("inlineCode",{parentName:"a"},"app.previous")," PageState")," when switching from one route to another."),(0,r.kt)("li",{parentName:"ul"},"Automatically closes the modal and drawer when switching from one route to another."),(0,r.kt)("li",{parentName:"ul"},"Applies ",(0,r.kt)("inlineCode",{parentName:"li"},"this.bodyClass")," (if defined) to the '#app' HTML element when the page renders."),(0,r.kt)("li",{parentName:"ul"},"It's also good for consistency's sake to use a common base class for all pages."),(0,r.kt)("li",{parentName:"ul"},"If the page's ",(0,r.kt)("inlineCode",{parentName:"li"},"scrollTopOnCreate")," attribute is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," in ",(0,r.kt)("inlineCode",{parentName:"li"},"oninit"),", the page won't be scrolled to the top when changed."),(0,r.kt)("li",{parentName:"ul"},"If the page's ",(0,r.kt)("inlineCode",{parentName:"li"},"useBrowserScrollRestoration")," is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," in ",(0,r.kt)("inlineCode",{parentName:"li"},"oninit"),", the browser's automatic scroll restoration won't be used on that page.")),(0,r.kt)("p",null,"Page components work just like any other inherited component. For a (very simple) example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import Page from 'duroom/common/components/Page';\n\n\nexport default class CustomPage extends Page {\n  view() {\n    return <p>Hello!</p>\n  }\n}\n")),(0,r.kt)("h3",{id:"setting-page-as-homepage"},"Setting Page as Homepage"),(0,r.kt)("p",null,"DuRoom uses a setting to determine which page should be the homepage: this gives admins flexibility to customize their communities.\nTo add your custom page to the homepage options in Admin, you'll need to extend the ",(0,r.kt)("inlineCode",{parentName:"p"},"BasicsPage.homePageItems")," method with your page's path."),(0,r.kt)("p",null,"An example from the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/tags/blob/master/js/src/admin/addTagsHomePageOption.js"},"Tags extension"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { extend } from 'duroom/common/extend';\nimport BasicsPage from 'duroom/common/components/BasicsPage';\n\nexport default function() {\n  extend(BasicsPage.prototype, 'homePageItems', items => {\n    items.add('tags', {\n      path: '/tags',\n      label: app.translator.trans('duroom-tags.admin.basics.tags_label')\n    });\n  });\n}\n")),(0,r.kt)("p",null,"To learn how to set up a path/route for your custom page, see the ",(0,r.kt)("a",{parentName:"p",href:"/extend/routes"},"relevant documentation"),"."),(0,r.kt)("h3",{id:"page-titles"},"Page Titles"),(0,r.kt)("p",null,"Often, you'll want some custom text to appear in the browser tab's title for your page.\nFor instance, a tags page might want to show \"Tags - FORUM NAME\", or a discussion page might want to show the title of the discussion."),(0,r.kt)("p",null,"To do this, your page should include calls to ",(0,r.kt)("inlineCode",{parentName:"p"},"app.setTitle()")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"app.setTitleCount()")," in its ",(0,r.kt)("inlineCode",{parentName:"p"},"oncreate")," ",(0,r.kt)("a",{parentName:"p",href:"/extend/frontend"},"lifecycle hook")," (or when data is loaded, if it pulls in data from the API)."),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import Page from \'duroom/common/components/Page\';\n\n\nexport default class CustomPage extends Page {\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    app.setTitle("Cool Page");\n    app.setTitleCount(0);\n  }\n\n  view() {\n    // ...\n  }\n}\n\nexport default class CustomPageLoadsData extends Page {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    app.store.find("users", 1).then(user => {\n      app.setTitle(user.displayName());\n      app.setTitleCount(0);\n    })\n  }\n\n  view() {\n    // ...\n  }\n}\n')),(0,r.kt)("p",null,"Please note that if your page is ",(0,r.kt)("a",{parentName:"p",href:"#setting-page-as-homepage"},"set as the homepage"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"app.setTitle()")," will clear the title for simplicity.\nIt should still be called though, to prevent titles from previous pages from carrying over."),(0,r.kt)("h2",{id:"pagestate"},"PageState"),(0,r.kt)("p",null,"Sometimes, we want to get information about the page we're currently on, or the page we've just come from.\nTo allow this, DuRoom creates (and stores) instances of ",(0,r.kt)("a",{parentName:"p",href:"https://api.duroom.js.org/docs/js/master/class/src/common/states/pagestate.js~pagestate"},(0,r.kt)("inlineCode",{parentName:"a"},"PageState"))," as ",(0,r.kt)("inlineCode",{parentName:"p"},"app.current")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"app.previous"),".\nThese store:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The component class being used for the page"),(0,r.kt)("li",{parentName:"ul"},"A collection of data that each page sets about itself. The current route name is always included.")),(0,r.kt)("p",null,"Data can be set to, and retrieved from, Page State using:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"app.current.set(KEY, DATA);\napp.current.get(KEY);\n")),(0,r.kt)("p",null,"For example, this is how the Discussion Page makes its ",(0,r.kt)("a",{parentName:"p",href:"https://api.duroom.js.org/docs/js/master/class/src/forum/states/poststreamstate.js~poststreamstate"},(0,r.kt)("inlineCode",{parentName:"a"},"PostStreamState"))," instance globally available."),(0,r.kt)("p",null,"You can also check the type and data of a page using ",(0,r.kt)("inlineCode",{parentName:"p"},"PostStreamState"),"'s ",(0,r.kt)("inlineCode",{parentName:"p"},"matches")," method. For instance, if we want to know if we are currently on a discussion page:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"import IndexPage from 'duroom/forum/components/DiscussionPage';\nimport DiscussionPage from 'duroom/forum/components/DiscussionPage';\n\n// To just check page type\napp.current.matches(DiscussionPage);\n\n// To check page type and some data\napp.current.matches(IndexPage, {routeName: 'following'});\n")),(0,r.kt)("h2",{id:"admin-pages"},"Admin Pages"),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/admin"},"Admin Dashboard documentation")," for more information on tools specifically available to admin pages (and how to override the admin page for your extension)."),(0,r.kt)("h2",{id:"route-resolvers-advanced"},"Route Resolvers (Advanced)"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://mithril.js.org/route.html#advanced-component-resolution"},"Advanced use cases")," can take advantage of Mithril's ",(0,r.kt)("a",{parentName:"p",href:"https://mithril.js.org/route.html#routeresolver"},"route resolver system"),".\nDuRoom actually already wraps all its components in the ",(0,r.kt)("inlineCode",{parentName:"p"},"duroom/common/resolvers/DefaultResolver")," resolver. This has the following benefits:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"It passes a ",(0,r.kt)("inlineCode",{parentName:"li"},"routeName")," attr to the current page, which then provides it to ",(0,r.kt)("inlineCode",{parentName:"li"},"PageState")),(0,r.kt)("li",{parentName:"ul"},"It assigns a ",(0,r.kt)("a",{parentName:"li",href:"https://mithril.js.org/keys.html#single-child-keyed-fragments"},"key")," to the top level page component. When the route changes, if the top level component's key has changed, it will be completely rerendered (by default, Mithril does not rerender components when switching from one page to another if both are handled by the same component).")),(0,r.kt)("h3",{id:"using-route-resolvers"},"Using Route Resolvers"),(0,r.kt)("p",null,"There are actually 3 ways to set the component / route resolver when registering a route:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the ",(0,r.kt)("inlineCode",{parentName:"li"},"resolver")," key can be used to provide an ",(0,r.kt)("strong",{parentName:"li"},"instance")," of a route resolver. This instance should define which component should be used, and hardcode the route name to be passed into it. This instance will be used without any modifications by DuRoom."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"resolverClass")," key AND ",(0,r.kt)("inlineCode",{parentName:"li"},"component")," key can be used to provide a ",(0,r.kt)("strong",{parentName:"li"},"class")," that will be used to instantiate a route resolver, to be used instead of DuRoom's default one, as well as the component to use. Its constructor should take 2 arguments: ",(0,r.kt)("inlineCode",{parentName:"li"},"(component, routeName)"),"."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"component")," key can be used alone to provide a component. This will result in the default behavior.")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// See above for a custom page example\nimport CustomPage from './components/CustomPage';\n// See below for a custom resolver example\nimport CustomPageResolver from './resolvers/CustomPageResolver';\n\n// Use a route resolver instance\napp.routes['resolverInstance'] = {path: '/custom/path/1', resolver: {\n  onmatch: function(args) {\n    if (!app.session.user) return m.route.SKIP;\n\n    return CustomPage;\n  }\n}};\n\n// Use a custom route resolver class\napp.routes['resolverClass'] = {path: '/custom/path/2', resolverClass: CustomPageResolver, component: CustomPage};\n\n// Use the default resolver class (`duroom/common/resolvers/DefaultResolver`)\napp.routes['resolverClass'] = {path: '/custom/path/2', component: CustomPage};\n")),(0,r.kt)("h3",{id:"custom-resolvers"},"Custom Resolvers"),(0,r.kt)("p",null,"We strongly encourage custom route resolvers to extend ",(0,r.kt)("inlineCode",{parentName:"p"},"duroom/common/resolvers/DefaultResolver"),".\nFor example, DuRoom's ",(0,r.kt)("inlineCode",{parentName:"p"},"duroom/forum/resolvers/DiscussionPageResolver")," assigns the same key to all links to the same discussion (regardless of the current post), and triggers scrolling when using ",(0,r.kt)("inlineCode",{parentName:"p"},"m.route.set")," to go from one post to another on the same discussion page:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import DefaultResolver from '../../common/resolvers/DefaultResolver';\n\n/**\n * This isn't exported as it is a temporary measure.\n * A more robust system will be implemented alongside UTF-8 support in beta 15.\n */\nfunction getDiscussionIdFromSlug(slug: string | undefined) {\n  if (!slug) return;\n  return slug.split('-')[0];\n}\n\n/**\n * A custom route resolver for DiscussionPage that generates the same key to all posts\n * on the same discussion. It triggers a scroll when going from one post to another\n * in the same discussion.\n */\nexport default class DiscussionPageResolver extends DefaultResolver {\n  static scrollToPostNumber: number | null = null;\n\n  makeKey() {\n    const params = { ...m.route.param() };\n    if ('near' in params) {\n      delete params.near;\n    }\n    params.id = getDiscussionIdFromSlug(params.id);\n    return this.routeName.replace('.near', '') + JSON.stringify(params);\n  }\n\n  onmatch(args, requestedPath, route) {\n    if (route.includes('/d/:id') && getDiscussionIdFromSlug(args.id) === getDiscussionIdFromSlug(m.route.param('id'))) {\n      DiscussionPageResolver.scrollToPostNumber = parseInt(args.near);\n    }\n\n    return super.onmatch(args, requestedPath, route);\n  }\n\n  render(vnode) {\n    if (DiscussionPageResolver.scrollToPostNumber !== null) {\n      const number = DiscussionPageResolver.scrollToPostNumber;\n      // Scroll after a timeout to avoid clashes with the render.\n      setTimeout(() => app.current.get('stream').goToNumber(number));\n      DiscussionPageResolver.scrollToPostNumber = null;\n    }\n\n    return super.render(vnode);\n  }\n}\n")))}d.isMDXComponent=!0}}]);