"use strict";(self.webpackChunkduroom_docs=self.webpackChunkduroom_docs||[]).push([[9469],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return c}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),u=p(n),c=a,h=u["".concat(l,".").concat(c)]||u[c]||d[c]||i;return n?o.createElement(h,r(r({ref:t},m),{},{components:n})):o.createElement(h,r({ref:t},m))}));function c(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var p=2;p<i;p++)r[p]=n[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6565:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return l},default:function(){return c},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return d}});var o=n(7462),a=n(3366),i=(n(7294),n(3905)),r=["components"],s={},l="Frontend Development",p={unversionedId:"extend/frontend",id:"extend/frontend",title:"Frontend Development",description:"This page describes how to make changes to DuRoom's user interface. How to add buttons, marquees, and blinking text. \ud83e\udd29",source:"@site/docs/extend/frontend.md",sourceDirName:"extend",slug:"/extend/frontend",permalink:"/docs/vi/extend/frontend",draft:!1,editUrl:"https://github.com/DuRoom/docs/tree/master/docs/extend/frontend.md",tags:[],version:"current",frontMatter:{},sidebar:"extendSidebar",previous:{title:"Getting Started",permalink:"/docs/vi/extend/start"},next:{title:"Routes and Content",permalink:"/docs/vi/extend/routes"}},m={},d=[{value:"Transpilation and File Structure",id:"transpilation-and-file-structure",level:2},{value:"package.json",id:"packagejson",level:3},{value:"webpack.config.js",id:"webpackconfigjs",level:3},{value:"tsconfig.json",id:"tsconfigjson",level:3},{value:"admin.js and forum.js",id:"adminjs-and-forumjs",level:3},{value:"src",id:"src",level:3},{value:"Importing",id:"importing",level:3},{value:"Transpilation",id:"transpilation",level:3},{value:"Asset Registration",id:"asset-registration",level:2},{value:"JavaScript",id:"javascript",level:3},{value:"CSS",id:"css",level:3},{value:"Changing the UI Part 1",id:"changing-the-ui-part-1",level:2},{value:"Components",id:"components",level:2},{value:"Changing the UI Part 2",id:"changing-the-ui-part-2",level:2},{value:"ItemList",id:"itemlist",level:3},{value:"<code>extend</code> and <code>override</code>",id:"extend-and-override",level:3},{value:"DuRoom Utils",id:"duroom-utils",level:3}],u={toc:d};function c(e){var t=e.components,n=(0,a.Z)(e,r);return(0,i.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"frontend-development"},"Frontend Development"),(0,i.kt)("p",null,"This page describes how to make changes to DuRoom's user interface. How to add buttons, marquees, and blinking text. \ud83e\udd29"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/docs/vi/extend/start#architecture"},"Remember"),", DuRoom's frontend is a ",(0,i.kt)("strong",{parentName:"p"},"single-page JavaScript application"),". There's no Twig, Blade, or any other kind of PHP template to speak of. The few templates that are present in the backend are only used to render search-engine-optimized content. All changes to the UI need to be made via JavaScript."),(0,i.kt)("p",null,"DuRoom has two separate frontend applications:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"forum"),", the public side of your forum where users create discussions and posts."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"admin"),", the private side of your forum where, as an administrator of your forum, you configure your DuRoom installation.")),(0,i.kt)("p",null,"They share the same foundational code, so once you know how to extend one, you know how to extend both."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Typings!")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Along with new TypeScript support, we have a ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/duroom-tsconfig"},(0,i.kt)("inlineCode",{parentName:"a"},"tsconfig")," package")," available, which you should install as a dev dependency to gain access to our typings. Make sure you follow the instructions in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/duroom-tsconfig#readme"},"package's README")," to configure typings support."))),(0,i.kt)("h2",{id:"transpilation-and-file-structure"},"Transpilation and File Structure"),(0,i.kt)("p",null,"This portion of the guide will explain the necessary file setup for extensions. Once again, we highly recommend using the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/cli"},"DuRoom CLI")," to set up the file structure for you. That being said, you should still read this to understand what's going on beneath the surface."),(0,i.kt)("p",null,"Before we can write any JavaScript, we need to set up a ",(0,i.kt)("strong",{parentName:"p"},"transpiler"),". This allows us to use ",(0,i.kt)("a",{parentName:"p",href:"https://www.typescriptlang.org/"},"TypeScript")," and its magic in DuRoom core and extensions."),(0,i.kt)("p",null,"In order to do this transpilation, you need to be working in a capable environment. No, not the home/office kind of environment \u2013 you can work in the bathroom for all I care! I'm talking about the tools that are installed on your system. You'll need:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Node.js and npm (",(0,i.kt)("a",{parentName:"li",href:"https://nodejs.org/en/download/"},"Download"),")"),(0,i.kt)("li",{parentName:"ul"},"Webpack (",(0,i.kt)("inlineCode",{parentName:"li"},"npm install -g webpack"),")")),(0,i.kt)("p",null,"This can be tricky because everyone's system is different. From the OS you're using, to the program versions you have installed, to the user access permissions \u2013 I get chills just thinking about it! If you run into trouble, ",(0,i.kt)("del",{parentName:"p"},"tell him I said hi")," use ",(0,i.kt)("a",{parentName:"p",href:"https://google.com"},"Google")," to see if someone has encountered the same error as you and found a solution. If not, ask for help from the ",(0,i.kt)("a",{parentName:"p",href:"https://discuss-duroom.js.org"},"DuRoom Community"),"."),(0,i.kt)("p",null,"It's time to set up our little JavaScript transpilation project. Create a new folder in your extension called ",(0,i.kt)("inlineCode",{parentName:"p"},"js"),", then pop in a couple of new files. A typical extension will have the following frontend structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"js\n\u251c\u2500\u2500 dist (compiled js is placed here)\n\u251c\u2500\u2500 src\n\u2502   \u251c\u2500\u2500 admin\n\u2502   \u2514\u2500\u2500 forum\n\u251c\u2500\u2500 admin.js\n\u251c\u2500\u2500 forum.js\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u2514\u2500\u2500 webpack.config.js\n")),(0,i.kt)("h3",{id:"packagejson"},"package.json"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "private": true,\n  "name": "@acme/duroom-hello-world",\n  "dependencies": {\n    "duroom-webpack-config": "^1.0.0",\n    "webpack": "^4.0.0",\n    "webpack-cli": "^4.0.0"\n  },\n  "devDependencies": {\n    "duroom-tsconfig": "^1.0.0"\n  },\n  "scripts": {\n    "dev": "webpack --mode development --watch",\n    "build": "webpack --mode production"\n  }\n}\n')),(0,i.kt)("p",null,"This is a standard JS ",(0,i.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/files/package.json"},"package-description file"),", used by npm and Yarn (Javascript package managers). You can use it to add commands, js dependencies, and package metadata. We're not actually publishing a npm package: this is simply used to collect dependencies."),(0,i.kt)("p",null,"Please note that we do not need to include ",(0,i.kt)("inlineCode",{parentName:"p"},"duroom/core")," or any duroom extensions as dependencies: they will be automatically packaged when DuRoom compiles the frontends for all extensions."),(0,i.kt)("h3",{id:"webpackconfigjs"},"webpack.config.js"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const config = require('duroom-webpack-config');\n\nmodule.exports = config();\n")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://webpack.js.org/concepts/"},"Webpack")," is the system that actually compiles and bundles all the javascript (and its dependencies) for our extension.\nTo work properly, our extensions should use the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/duroom-webpack-config"},"official duroom webpack config")," (shown in the above example)."),(0,i.kt)("h3",{id:"tsconfigjson"},"tsconfig.json"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  // Use DuRoom\'s tsconfig as a starting point\n  "extends": "duroom-tsconfig",\n  // This will match all .ts, .tsx, .d.ts, .js, .jsx files in your `src` folder\n  // and also tells your Typescript server to read core\'s global typings for\n  // access to `dayjs` and `$` in the global namespace.\n  "include": ["src/**/*", "../vendor/duroom/core/js/dist-typings/@types/**/*"],\n  "compilerOptions": {\n    // This will output typings to `dist-typings`\n    "declarationDir": "./dist-typings",\n    "baseUrl": ".",\n    "paths": {\n      "duroom/*": ["../vendor/duroom/core/js/dist-typings/*"]\n    }\n  }\n}\n')),(0,i.kt)("p",null,"This is a standard configuration file to enable support for Typescript with the options that DuRoom needs."),(0,i.kt)("p",null,"Always ensure you're using the latest version of this file: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/duroom-tsconfig#readme"},"https://github.com/DuRoom/duroom-tsconfig#readme"),"."),(0,i.kt)("p",null,"Even if you choose not to use TypeScript in your extension, which is supported natively by our Webpack config, it's still recommended to install the ",(0,i.kt)("inlineCode",{parentName:"p"},"duroom-tsconfig")," package and to include this configuration file so that your IDE can infer types for our core JS."),(0,i.kt)("p",null,"To get the typings working, you'll need to run ",(0,i.kt)("inlineCode",{parentName:"p"},"composer update")," in your extension's folder to download the latest copy of DuRoom's core into a new ",(0,i.kt)("inlineCode",{parentName:"p"},"vendor")," folder. Remember not to commit this folder if you're using a version control system such as Git."),(0,i.kt)("p",null,'You may also need to restart your IDE\'s TypeScript server. In Visual Studio Code, you can press F1, then type "Restart TypeScript Server" and hit ENTER. This might take a minute to complete.'),(0,i.kt)("h3",{id:"adminjs-and-forumjs"},"admin.js and forum.js"),(0,i.kt)("p",null,"These files contain the root of our actual frontend JS. You could put your entire extension here, but that would not be well organized. For this reason, we recommend putting the actual\nsource code in ",(0,i.kt)("inlineCode",{parentName:"p"},"src"),", and having these files just export the contents of ",(0,i.kt)("inlineCode",{parentName:"p"},"src"),". For instance:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// admin.js\nexport * from './src/admin';\n\n// forum.js\nexport * from './src/forum';\n")),(0,i.kt)("h3",{id:"src"},"src"),(0,i.kt)("p",null,"If following the recommendations for ",(0,i.kt)("inlineCode",{parentName:"p"},"admin.js")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"forum.js"),", we'll want to have 2 subfolders here: one for ",(0,i.kt)("inlineCode",{parentName:"p"},"admin")," frontend code, and one for ",(0,i.kt)("inlineCode",{parentName:"p"},"forum")," frontend code.\nIf you have components, models, utils, or other code that is shared across both frontends, you may want to create a ",(0,i.kt)("inlineCode",{parentName:"p"},"common")," subfolder and place it there."),(0,i.kt)("p",null,"Structure for ",(0,i.kt)("inlineCode",{parentName:"p"},"admin")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"forum")," is identical, so we'll just show it for ",(0,i.kt)("inlineCode",{parentName:"p"},"forum")," here:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"src/forum/\n\u251c\u2500\u2500 components/\n|-- models/\n\u251c\u2500\u2500 utils/\n\u2514\u2500\u2500 index.js\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"components"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"models"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"utils")," are directories that contain files where you can define custom ",(0,i.kt)("a",{parentName:"p",href:"#components"},"components"),", ",(0,i.kt)("a",{parentName:"p",href:"/docs/vi/extend/models#frontend-models"},"models"),", and reusable util helper functions.\nPlease note that this is all simply a recommendation: there's nothing forcing you to use this particular file structure (or any other file structure)."),(0,i.kt)("p",null,"The most important file here is ",(0,i.kt)("inlineCode",{parentName:"p"},"index.js"),": everything else is just extracting classes and functions into their own files. Let's go over a typical ",(0,i.kt)("inlineCode",{parentName:"p"},"index.js")," file structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import { extend, override } from 'duroom/common/extend';\n\n// We provide our extension code in the form of an \"initializer\".\n// This is a callback that will run after the core has booted.\napp.initializers.add('acme-duroom-hello-world', function(app) {\n  // Your Extension Code Here\n  console.log(\"EXTENSION NAME is working!\");\n});\n")),(0,i.kt)("p",null,"We'll go over tools available for extensions below."),(0,i.kt)("h3",{id:"importing"},"Importing"),(0,i.kt)("p",null,"You should familiarize yourself with proper syntax for ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import"},"importing js modules"),", as most extensions larger than a few lines will split their js into multiple files."),(0,i.kt)("p",null,"Pretty much every DuRoom extension will need to import ",(0,i.kt)("em",{parentName:"p"},"something")," from DuRoom Core.\nLike most extensions, core's JS source code is split up into ",(0,i.kt)("inlineCode",{parentName:"p"},"admin"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"common"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"forum")," folders. You can import the file by prefixing its path in the DuRoom core source code with ",(0,i.kt)("inlineCode",{parentName:"p"},"duroom"),". So ",(0,i.kt)("inlineCode",{parentName:"p"},"admin/components/AdminLinkButton")," is available as ",(0,i.kt)("inlineCode",{parentName:"p"},"duroom/admin/components/AdminLinkButton"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"common/Component")," is available as ",(0,i.kt)("inlineCode",{parentName:"p"},"duroom/common/Component"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"forum/states/PostStreamState")," is available as ",(0,i.kt)("inlineCode",{parentName:"p"},"duroom/forum/states/PostStreamState"),"."),(0,i.kt)("p",null,"In some cases, an extension may want to extend code from another duroom extension. This is only possible for extensions which explicitly export their contents."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duroom/tags")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"duroom/flags")," are currently the only bundled extensions that allow extending their JS. You can import their contents from ",(0,i.kt)("inlineCode",{parentName:"li"},"duroom/{EXT_NAME}/PATH")," (e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"duroom/tags/components/TagHero"),")."),(0,i.kt)("li",{parentName:"ul"},"The process for extending each community extension is different; you should consult documentation for each individual extension.")),(0,i.kt)("h3",{id:"transpilation"},"Transpilation"),(0,i.kt)("p",null,"OK, time to fire up the transpiler. Run the following commands in the ",(0,i.kt)("inlineCode",{parentName:"p"},"js")," directory:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install\nnpm run dev\n")),(0,i.kt)("p",null,"This will compile your browser-ready JavaScript code into the ",(0,i.kt)("inlineCode",{parentName:"p"},"js/dist/forum.js")," file, and keep watching for changes to the source files. Nifty!"),(0,i.kt)("p",null,"When you've finished developing your extension (or before a new release), you'll want to run ",(0,i.kt)("inlineCode",{parentName:"p"},"npm run build")," instead of ",(0,i.kt)("inlineCode",{parentName:"p"},"npm run dev"),": this builds the extension in production mode, which makes the source code smaller and faster."),(0,i.kt)("h2",{id:"asset-registration"},"Asset Registration"),(0,i.kt)("h3",{id:"javascript"},"JavaScript"),(0,i.kt)("p",null,"In order for your extension's JavaScript to be loaded into the frontend, we need to tell DuRoom where to find it. We can do this using the ",(0,i.kt)("inlineCode",{parentName:"p"},"Frontend")," extender's ",(0,i.kt)("inlineCode",{parentName:"p"},"js")," method. Add it to your extension's ",(0,i.kt)("inlineCode",{parentName:"p"},"extend.php")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nuse DuRoom\\Extend;\n\nreturn [\n    (new Extend\\Frontend('forum'))\n        ->js(__DIR__.'/js/dist/forum.js')\n];\n")),(0,i.kt)("p",null,"DuRoom will make anything you ",(0,i.kt)("inlineCode",{parentName:"p"},"export")," from ",(0,i.kt)("inlineCode",{parentName:"p"},"forum.js")," available in the global ",(0,i.kt)("inlineCode",{parentName:"p"},"duroom.extensions['acme-hello-world']")," object. Thus, you may choose to expose your own public API for other extensions to interact with."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"External Libraries")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Only one main JavaScript file per extension is permitted. If you need to include any external JavaScript libraries, either install them with NPM and ",(0,i.kt)("inlineCode",{parentName:"p"},"import")," them so they are compiled into your JavaScript file, or see ",(0,i.kt)("a",{parentName:"p",href:"/docs/vi/extend/routes"},"Routes and Content")," to learn how to add extra ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>")," tags to the frontend document."))),(0,i.kt)("h3",{id:"css"},"CSS"),(0,i.kt)("p",null,"You can also add CSS and ",(0,i.kt)("a",{parentName:"p",href:"https://lesscss.org/features/"},"LESS")," assets to the frontend using the ",(0,i.kt)("inlineCode",{parentName:"p"},"Frontend")," extender's ",(0,i.kt)("inlineCode",{parentName:"p"},"css")," method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"    (new Extend\\Frontend('forum'))\n        ->js(__DIR__.'/js/dist/forum.js')\n        ->css(__DIR__.'/less/forum.less')\n")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You should develop extensions with debug mode turned ",(0,i.kt)("strong",{parentName:"p"},"on")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"config.php"),". This will ensure that DuRoom recompiles assets automatically, so you don't have to manually clear the cache every time you make a change to your extension JavaScript."))),(0,i.kt)("h2",{id:"changing-the-ui-part-1"},"Changing the UI Part 1"),(0,i.kt)("p",null,"DuRoom's interface is constructed using a JavaScript framework called ",(0,i.kt)("a",{parentName:"p",href:"https://mithril.js.org/"},"Mithril.js"),". If you are familiar with ",(0,i.kt)("a",{parentName:"p",href:"https://reactjs.org"},"React"),", then you'll catch on in no time. But if you are not familiar with any JavaScript frameworks, we suggest you go through a ",(0,i.kt)("a",{parentName:"p",href:"https://mithril.js.org/simple-application.html"},"tutorial")," to understand the fundamentals before proceeding."),(0,i.kt)("p",null,"The crux of it is that DuRoom generates virtual DOM elements which are a JavaScript representation of HTML. Mithril takes these virtual DOM elements and turns them into real HTML in the most efficient way possible. (That's why DuRoom is so speedy!)"),(0,i.kt)("p",null,"Because the interface is built with JavaScript, it's really easy to hook in and make changes. All you need to do is find the right extender for the part of the interface you want to change, and then add your own virtual DOM into the mix."),(0,i.kt)("p",null,"Most mutable parts of the interface are really just ",(0,i.kt)("em",{parentName:"p"},"lists of items"),". For example:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The controls that appear on each post (Reply, Like, Edit, Delete)"),(0,i.kt)("li",{parentName:"ul"},"The index sidebar navigation items (All Discussions, Following, Tags)"),(0,i.kt)("li",{parentName:"ul"},"The items in the header (Search, Notifications, User menu)")),(0,i.kt)("p",null,"Each item in these lists is given a ",(0,i.kt)("strong",{parentName:"p"},"name")," so you can easily add, remove, and rearrange the items. Simply find the appropriate component for the part of the interface you want to change, and monkey-patch its methods to modify the item list contents. For example, to add a link to Google in the header:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"import { extend } from 'duroom/common/extend';\nimport HeaderPrimary from 'duroom/forum/components/HeaderPrimary';\n\nextend(HeaderPrimary.prototype, 'items', function(items) {\n  items.add('google', <a href=\"https://google.com\">Google</a>);\n});\n")),(0,i.kt)("p",null,"Not bad! No doubt our users will be lining up to thank us for such quick and convenient access to Google."),(0,i.kt)("p",null,"In the above example, we use the ",(0,i.kt)("inlineCode",{parentName:"p"},"extend")," util (explained below) to add HTML to the output of ",(0,i.kt)("inlineCode",{parentName:"p"},"HeaderPrimary.prototype.items()"),". How does that actually work? Well, first we need to understand what HeaderPrimary even is."),(0,i.kt)("h2",{id:"components"},"Components"),(0,i.kt)("p",null,"DuRoom's interface is made up of many nested ",(0,i.kt)("strong",{parentName:"p"},"components"),". Components are a bit like HTML elements in that they encapsulate content and behavior. For example, look at this simplified tree of the components that make up a discussion page:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"DiscussionPage\n\u251c\u2500\u2500 DiscussionList (the side pane)\n\u2502   \u251c\u2500\u2500 DiscussionListItem\n\u2502   \u2514\u2500\u2500 DiscussionListItem\n\u251c\u2500\u2500 DiscussionHero (the title)\n\u251c\u2500\u2500 PostStream\n\u2502   \u251c\u2500\u2500 Post\n\u2502   \u2514\u2500\u2500 Post\n\u251c\u2500\u2500 SplitDropdown (the reply button)\n\u2514\u2500\u2500 PostStreamScrubber\n")),(0,i.kt)("p",null,"You should familiarize yourself with ",(0,i.kt)("a",{parentName:"p",href:"https://mithril.js.org/components.html"},"Mithril's component API")," and ",(0,i.kt)("a",{parentName:"p",href:"https://mithril.js.org/autoredraw.html"},"redraw system"),". DuRoom wraps components in the ",(0,i.kt)("inlineCode",{parentName:"p"},"duroom/common/Component")," class, which extends Mithril's ",(0,i.kt)("a",{parentName:"p",href:"https://mithril.js.org/components.html#classes"},"class components"),". It provides the following benefits:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Attributes passed to components are available throughout the class via ",(0,i.kt)("inlineCode",{parentName:"li"},"this.attrs"),"."),(0,i.kt)("li",{parentName:"ul"},"The static ",(0,i.kt)("inlineCode",{parentName:"li"},"initAttrs")," method mutates ",(0,i.kt)("inlineCode",{parentName:"li"},"this.attrs")," before setting them, and allows you to set defaults or otherwise modify them before using them in your class. Please note that this doesn't affect the initial ",(0,i.kt)("inlineCode",{parentName:"li"},"vnode.attrs"),"."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"$")," method returns a jQuery object for the component's root DOM element. You can optionally pass a selector to get DOM children."),(0,i.kt)("li",{parentName:"ul"},"the ",(0,i.kt)("inlineCode",{parentName:"li"},"component")," static method can be used as an alternative to JSX and the ",(0,i.kt)("inlineCode",{parentName:"li"},"m")," hyperscript. The following are equivalent:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"m(CustomComponentClass, attrs, children)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"CustomComponentClass.component(attrs, children)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"<CustomComponentClass {...attrs}>{children}</CustomComponentClass>"))))),(0,i.kt)("p",null,"However, component classes extending ",(0,i.kt)("inlineCode",{parentName:"p"},"Component")," must call ",(0,i.kt)("inlineCode",{parentName:"p"},"super")," when using the lifecycle methods (",(0,i.kt)("inlineCode",{parentName:"p"},"oninit"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"oncreate"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"onbeforeupdate"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"onupdate"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"onbeforeremove"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"onremove"),")."),(0,i.kt)("p",null,"To use DuRoom components, simply extend ",(0,i.kt)("inlineCode",{parentName:"p"},"duroom/common/Component")," in your custom component class."),(0,i.kt)("p",null,"All other properties of Mithril components, including ",(0,i.kt)("a",{parentName:"p",href:"https://mithril.js.org/lifecycle-methods.html"},"lifecycle methods")," (which you should familiarize yourself with), are preserved.\nWith this in mind, a custom component class might look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"import Component from 'duroom/common/Component';\n\nclass Counter extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.count = 0;\n  }\n\n  view() {\n    return (\n      <div>\n        Count: {this.count}\n        <button onclick={e => this.count++}>\n          {this.attrs.buttonLabel}\n        </button>\n      </div>\n    );\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n\n    // We aren't actually doing anything here, but this would\n    // be a good place to attach event handlers, initialize libraries\n    // like sortable, or make other DOM modifications.\n    $element = this.$();\n    $button = this.$('button');\n  }\n}\n\nm.mount(document.body, <MyComponent buttonLabel=\"Increment\" />);\n")),(0,i.kt)("h2",{id:"changing-the-ui-part-2"},"Changing the UI Part 2"),(0,i.kt)("p",null,"Now that we have a better understanding of the component system, let's go a bit more in-depth into how extending the UI works."),(0,i.kt)("h3",{id:"itemlist"},"ItemList"),(0,i.kt)("p",null,"As noted above, most easily extensible parts of the UI allow you to extend methods called ",(0,i.kt)("inlineCode",{parentName:"p"},"items")," or something similar (e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"controlItems"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"accountItems"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"toolbarItems"),", etc. Exact names depend on the component you are extending) to add, remove, or replace elements. Under the surface, these methods return a ",(0,i.kt)("inlineCode",{parentName:"p"},"utils/ItemList")," instance, which is essentially an ordered object. Detailed documentation of its methods is available in ",(0,i.kt)("a",{parentName:"p",href:"https://api.duroom.js.org/docs/js/master/class/src/common/utils/itemlist.ts~itemlist"},"our API documentation"),". When the ",(0,i.kt)("inlineCode",{parentName:"p"},"toArray")," method of ItemList is called, items are returned in ascending order of priority (0 if not provided), then by key alphabetically where priorities are equal."),(0,i.kt)("h3",{id:"extend-and-override"},(0,i.kt)("inlineCode",{parentName:"h3"},"extend")," and ",(0,i.kt)("inlineCode",{parentName:"h3"},"override")),(0,i.kt)("p",null,"Pretty much all frontend extensions use ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Monkey_patch"},"monkey patching")," to add, modify, or remove behavior. For instance:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},'// This adds an attribute to the `app` global.\napp.googleUrl = "https://google.com";\n\n// This replaces the output of the discussion page with "Hello World"\nimport DiscussionPage from \'duroom/forum/components/DiscussionPage\';\n\nDiscussionPage.prototype.view = function() {\n  return <p>Hello World</p>;\n}\n')),(0,i.kt)("p",null,'...will turn DuRoom\'s discussion pages into proclamations of "Hello World". How creative!'),(0,i.kt)("p",null,"In most cases, we don't actually want to completely replace the methods we are modifying. For this reason, DuRoom includes ",(0,i.kt)("inlineCode",{parentName:"p"},"extend")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"override")," utils. ",(0,i.kt)("inlineCode",{parentName:"p"},"extend")," allows us to add code to run after a method has completed. ",(0,i.kt)("inlineCode",{parentName:"p"},"override")," allows us to replace a method with a new one, while keeping the old method available as a callback. Both are functions that take 3 arguments:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The prototype of a class (or some other extensible object)"),(0,i.kt)("li",{parentName:"ol"},"The string name of a method in that class"),(0,i.kt)("li",{parentName:"ol"},"A callback that performs the modification.",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"For ",(0,i.kt)("inlineCode",{parentName:"li"},"extend"),", the callback receives the output of the original method, as well as any arguments passed to the original method."),(0,i.kt)("li",{parentName:"ol"},"For ",(0,i.kt)("inlineCode",{parentName:"li"},"override"),", the callback receives a callable (which can be used to call the original method), as well as any arguments passed to the original method.")))),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Overriding multiple methods")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"With ",(0,i.kt)("inlineCode",{parentName:"p"},"extend")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"override"),", you can also pass an array of multiple methods that you want to patch. This will apply the same modifications to all of the methods you provide:"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"extend(IndexPage.prototype, ['oncreate', 'onupdate'], () => { /* your logic */ });\n")))),(0,i.kt)("p",null,"Please note that if you are trying to change the output of a method with ",(0,i.kt)("inlineCode",{parentName:"p"},"override"),", you must return the new output.\nIf you are changing output with ",(0,i.kt)("inlineCode",{parentName:"p"},"extend"),", you should simply modify the original output (which is received as the first argument).\nKeep in mind that ",(0,i.kt)("inlineCode",{parentName:"p"},"extend")," can only mutate output if the output is mutable (e.g. an object or array, and not a number/string)."),(0,i.kt)("p",null,'Let\'s now revisit the original "adding a link to Google to the header" example to demonstrate.'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"import { extend, override } from 'duroom/common/extend';\nimport HeaderPrimary from 'duroom/forum/components/HeaderPrimary';\nimport ItemList from 'duroom/common/utils/ItemList';\nimport CustomComponentClass from './components/CustomComponentClass';\n\n// Here, we add an item to the returned ItemList. We are using a custom component\n// as discussed above. We've also specified a priority as the third argument,\n// which will be used to order these items. Note that we don't need to return anything.\nextend(HeaderPrimary.prototype, 'items', function(items) {\n  items.add(\n    'google',\n    <CustomComponentClass>\n      <a href=\"https://google.com\">Google</a>\n    </CustomComponentClass>,\n    5\n  );\n});\n\n// Here, we conditionally use the original output of a method,\n// or create our own ItemList, and then add an item to it.\n// Note that we MUST return our custom output.\noverride(HeaderPrimary.prototype, 'items', function(original) {\n  let items;\n\n  if (someArbitraryCondition) {\n    items = original();\n  } else {\n    items = new ItemList();\n  }\n\n  items.add('google', <a href=\"https://google.com\">Google</a>);\n\n  return items;\n});\n")),(0,i.kt)("p",null,"Since all DuRoom components and utils are represented by classes, ",(0,i.kt)("inlineCode",{parentName:"p"},"extend"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"override"),', and regular old JS mean that we can hook into, or replace, ANY method in any part of DuRoom.\nSome potential "advanced" uses include:'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Extending or overriding ",(0,i.kt)("inlineCode",{parentName:"li"},"view")," to change (or completely redefine) the html structure of DuRoom components. This opens DuRoom up to unlimited theming"),(0,i.kt)("li",{parentName:"ul"},"Hooking into Mithril component methods to add JS event listeners, or otherwise redefine business logic.")),(0,i.kt)("h3",{id:"duroom-utils"},"DuRoom Utils"),(0,i.kt)("p",null,"DuRoom defines (and provides) quite a few util and helper functions, which you may want to use in your extensions. A few particularly useful ones:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duroom/common/utils/Stream")," provides ",(0,i.kt)("a",{parentName:"li",href:"https://mithril.js.org/stream.html"},"Mithril Streams"),", and is useful in ",(0,i.kt)("a",{parentName:"li",href:"/docs/vi/extend/forms"},"forms"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duroom/common/utils/classList")," provides the ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/clsx"},"clsx library"),", which is great for dynamically assembling a list of CSS classes for your components"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duroom/common/utils/extractText")," extracts text as a string from Mithril component vnode instances (or translation vnodes)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duroom/common/utils/throttleDebounce")," provides the ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/throttle-debounce"},"throttle-debounce")," library"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duroom/common/helpers/avatar")," displays a user's avatar"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duroom/common/helpers/highlight")," highlights text in strings: great for search results!"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duroom/common/helpers/icon")," displays an icon, usually used for FontAwesome."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"duroom/common/helpers/username"),' shows a user\'s display name, or "deleted" text if the user has been deleted.')),(0,i.kt)("p",null,"And there's a bunch more! Some are covered elsewhere in the docs, but the best way to learn about them is through ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/DuRoom/framework/tree/main/framework/core/js"},"the source code")," or ",(0,i.kt)("a",{parentName:"p",href:"https://api.duroom.js.org/docs/js/"},"our javascript API documentation"),"."))}c.isMDXComponent=!0}}]);